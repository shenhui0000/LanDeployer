import{g as A,t as S,d as F,u as G,s as J}from"./host-aZwPL29u.js";import{_ as L,r as _,o as O,c as Q,a as v,b as l,w as a,d as r,E as d,g as W,e as X,h as Y,f as s,i as y,j as U,k as Z}from"./index-B5noXiXf.js";import"./request-Czxk6xGR.js";const ee={class:"hosts-page"},le={class:"toolbar"},ae={__name:"Hosts",setup(te){const c=_(!1),C=_([]),g=_(!1),w=_("添加服务器"),x=_(null),t=_({name:"",ip:"",port:22,username:"root",authType:"password",password:"",privateKey:"",remotePath:"/opt/offline",groupName:"",description:""}),N={name:[{required:!0,message:"请输入主机名称",trigger:"blur"}],ip:[{required:!0,message:"请输入IP地址",trigger:"blur"}],port:[{required:!0,message:"请输入端口",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],authType:[{required:!0,message:"请选择认证方式",trigger:"change"}],remotePath:[{required:!0,message:"请输入部署路径",trigger:"blur"}]},b=async()=>{c.value=!0;try{const u=await A();C.value=u.data||[]}catch{d.error("加载服务器列表失败")}finally{c.value=!1}},h=()=>{w.value="添加服务器",t.value={name:"",ip:"",port:22,username:"root",authType:"password",password:"",privateKey:"",remotePath:"/opt/offline",groupName:"",description:""},g.value=!0},H=u=>{w.value="编辑服务器",t.value={...u},g.value=!0},K=async()=>{await x.value.validate();try{t.value.id?(await G(t.value.id,t.value),d.success("更新成功")):(await J(t.value),d.success("添加成功")),g.value=!1,b()}catch{d.error("操作失败")}},q=async u=>{try{await Z.confirm("确定要删除这台服务器吗？","提示",{type:"warning"}),await F(u.id),d.success("删除成功"),b()}catch(e){e!=="cancel"&&d.error("删除失败")}},B=async u=>{var V;const e=d.loading("正在测试连接...");try{const i=await S(u);e.close(),i.data&&i.data.success?(d.success(`连接成功！响应时间: ${i.data.responseTime}ms`),b()):d.error(((V=i.data)==null?void 0:V.message)||"连接失败")}catch{e.close(),d.error("测试失败")}};return O(()=>{b()}),(u,e)=>{const V=r("Plus"),i=r("el-icon"),f=r("el-button"),E=r("Refresh"),p=r("el-table-column"),k=r("el-tag"),I=r("el-table"),$=r("el-card"),m=r("el-input"),n=r("el-form-item"),M=r("el-input-number"),P=r("el-radio"),R=r("el-radio-group"),z=r("el-form"),D=r("el-dialog"),j=W("loading");return v(),Q("div",ee,[l($,null,{default:a(()=>[X("div",le,[l(f,{type:"primary",onClick:h},{default:a(()=>[l(i,null,{default:a(()=>[l(V)]),_:1}),e[12]||(e[12]=s(" 添加服务器 ",-1))]),_:1}),l(f,{onClick:b},{default:a(()=>[l(i,null,{default:a(()=>[l(E)]),_:1}),e[13]||(e[13]=s(" 刷新 ",-1))]),_:1})]),Y((v(),y(I,{data:C.value,style:{"margin-top":"20px"}},{default:a(()=>[l(p,{prop:"name",label:"名称",width:"150"}),l(p,{prop:"ip",label:"IP地址",width:"150"}),l(p,{prop:"port",label:"端口",width:"80"}),l(p,{prop:"username",label:"用户名",width:"100"}),l(p,{prop:"remotePath",label:"部署路径",width:"180"}),l(p,{prop:"groupName",label:"分组",width:"100"}),l(p,{label:"状态",width:"100"},{default:a(({row:o})=>[o.status==="online"?(v(),y(k,{key:0,type:"success"},{default:a(()=>[...e[14]||(e[14]=[s("在线",-1)])]),_:1})):o.status==="offline"?(v(),y(k,{key:1,type:"danger"},{default:a(()=>[...e[15]||(e[15]=[s("离线",-1)])]),_:1})):(v(),y(k,{key:2,type:"info"},{default:a(()=>[...e[16]||(e[16]=[s("未知",-1)])]),_:1}))]),_:1}),l(p,{prop:"description",label:"描述","show-overflow-tooltip":""}),l(p,{label:"操作",width:"260",fixed:"right"},{default:a(({row:o})=>[l(f,{size:"small",onClick:T=>B(o)},{default:a(()=>[...e[17]||(e[17]=[s("测试",-1)])]),_:1},8,["onClick"]),l(f,{size:"small",type:"primary",onClick:T=>H(o)},{default:a(()=>[...e[18]||(e[18]=[s("编辑",-1)])]),_:1},8,["onClick"]),l(f,{size:"small",type:"danger",onClick:T=>q(o)},{default:a(()=>[...e[19]||(e[19]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[j,c.value]])]),_:1}),l(D,{modelValue:g.value,"onUpdate:modelValue":e[11]||(e[11]=o=>g.value=o),title:w.value,width:"600px"},{footer:a(()=>[l(f,{onClick:e[10]||(e[10]=o=>g.value=!1)},{default:a(()=>[...e[22]||(e[22]=[s("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:K},{default:a(()=>[...e[23]||(e[23]=[s("确定",-1)])]),_:1})]),default:a(()=>[l(z,{model:t.value,rules:N,ref_key:"formRef",ref:x,"label-width":"120px"},{default:a(()=>[l(n,{label:"名称",prop:"name"},{default:a(()=>[l(m,{modelValue:t.value.name,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.name=o),placeholder:"请输入主机名称"},null,8,["modelValue"])]),_:1}),l(n,{label:"IP地址",prop:"ip"},{default:a(()=>[l(m,{modelValue:t.value.ip,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.ip=o),placeholder:"请输入IP地址"},null,8,["modelValue"])]),_:1}),l(n,{label:"端口",prop:"port"},{default:a(()=>[l(M,{modelValue:t.value.port,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.port=o),min:1,max:65535},null,8,["modelValue"])]),_:1}),l(n,{label:"用户名",prop:"username"},{default:a(()=>[l(m,{modelValue:t.value.username,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.username=o),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(n,{label:"认证方式",prop:"authType"},{default:a(()=>[l(R,{modelValue:t.value.authType,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.authType=o)},{default:a(()=>[l(P,{label:"password"},{default:a(()=>[...e[20]||(e[20]=[s("密码",-1)])]),_:1}),l(P,{label:"privateKey"},{default:a(()=>[...e[21]||(e[21]=[s("私钥",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t.value.authType==="password"?(v(),y(n,{key:0,label:"密码",prop:"password"},{default:a(()=>[l(m,{modelValue:t.value.password,"onUpdate:modelValue":e[5]||(e[5]=o=>t.value.password=o),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})):U("",!0),t.value.authType==="privateKey"?(v(),y(n,{key:1,label:"私钥",prop:"privateKey"},{default:a(()=>[l(m,{modelValue:t.value.privateKey,"onUpdate:modelValue":e[6]||(e[6]=o=>t.value.privateKey=o),type:"textarea",rows:4,placeholder:"请输入私钥内容"},null,8,["modelValue"])]),_:1})):U("",!0),l(n,{label:"部署路径",prop:"remotePath"},{default:a(()=>[l(m,{modelValue:t.value.remotePath,"onUpdate:modelValue":e[7]||(e[7]=o=>t.value.remotePath=o),placeholder:"/opt/offline"},null,8,["modelValue"])]),_:1}),l(n,{label:"分组"},{default:a(()=>[l(m,{modelValue:t.value.groupName,"onUpdate:modelValue":e[8]||(e[8]=o=>t.value.groupName=o),placeholder:"请输入分组名称"},null,8,["modelValue"])]),_:1}),l(n,{label:"描述"},{default:a(()=>[l(m,{modelValue:t.value.description,"onUpdate:modelValue":e[9]||(e[9]=o=>t.value.description=o),type:"textarea",rows:2,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ue=L(ae,[["__scopeId","data-v-84fb682e"]]);export{ue as default};
